@{
    ViewBag.Title = "moveObject";
}

<h2>moveObject</h2>
<style>
    .shape {
    border-radius: 50px;
    width:58px;
    height:58px;
    border: 1px solid yellow;
    background-color : seagreen;
    cursor: move;
    }

</style>



<div class="board" style="width:720px; height:300px; margin:10px; background-color:lightblue">
               <div id="a1" class="droppable"> </div>
                <div id="a2"  class="droppable"> </div>
                <div id="a3"  class="droppable"> </div>
                <div id="a4"  class="droppable"> </div>
                <div id="a5"  class="droppable"> </div>
                <div id="a6"  class="droppable"> </div>
                <div id="a7"  class="droppable"> </div>
                <div id="a8"  class="droppable"> </div>
                <div id="a9"  class="droppable"> </div>
                <div id="a10"  class="droppable"> </div>
                <div id="a11"  class="droppable"> </div>
                <div id="a12"  class="droppable"> </div>
                <div id="b1"  class="droppable"> </div>
                <div id="b2"  class="droppable"> </div>
                <div id="b3"  class="droppable"> </div>
                <div id="b4"  class="droppable"> </div>
                <div id="b5"  class="droppable"> </div>
                <div id="b6"  class="droppable"> </div>
                <div id="b7"  class="droppable"> </div>
                <div id="b8"  class="droppable"> </div>
                <div id="b9"><div class="someone " > </div> </div>
                <div id="b10"  class="droppable"> </div>
                <div id="b11"  class="droppable"> </div>
                <div id="b12"  class="droppable"> </div>
                <div id="c1"  class="droppable"> </div>
                <div id="c2"  class="droppable"> </div>
                <div id="c3"  class="droppable"> </div>
                <div id="c4"  class="droppable"> </div>
                <div id="c5"  class="droppable"> </div>
                <div id="c6"  class="droppable"> </div>
                <div id="c7"  class="droppable"> </div>
                <div id="c8"  class="droppable"> </div>
                <div id="c9"  class="droppable"> </div>
                <div id="c10"  class="droppable"> </div>
                <div id="c11"  class="droppable"> </div>
                <div id="c12"  class="droppable"> </div>
                <div id="d1"  class="droppable"> </div>
                <div id="d2"  class="droppable"> </div>
                <div id="d3"  class="droppable"> </div>
                <div id="d4"  class="droppable"> </div>
                <div id="d5"  class="droppable"> </div>
                <div id="d6"  class="droppable"> </div>
                <div id="d7"  class="droppable"> </div>
                <div id="d8"  class="droppable"> </div>
                <div id="d9"  class="droppable"> </div>
                <div id="d10"  class="droppable"> </div>
                <div id="d11"  class="droppable"> </div>
                <div id="d12"  class="droppable"> </div>
                <div id="e1"  class="droppable"> </div>
                <div id="e2"  class="droppable"> </div>
                <div id="e3"  class="droppable"> </div>
                <div id="e4"  class="droppable"> </div>
                <div id="e5"  class="droppable"> </div>
                <div id="e6"  class="droppable"> </div>
                <div id="e7"  class="droppable"> </div>
                <div id="e8"  class="droppable"> </div>
                <div id="e9"  class="droppable"> </div>
                <div id="e10"  class="droppable"> </div>
                <div id="e11"  class="droppable"> </div>
                <div id="e12"  class="droppable"> </div>
 </div>


<div class="newusers">
    <b>Novos Users</b>

</div>


@section scripts{
     <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery-1.9.1.js"></script>
    <script src="~/Scripts/jquery-ui-1.10.3.js"></script>
    <script src="~/Scripts/jquery.signalR-1.1.3.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->

    <script src="~/signalr/hubs"></script>
    
    <!--SignalR script to update the chat page and send messages.--> 
    <script>
        
        $(function () {
            var hub = $.connection.moveObjectHub;


            $shape = $("#@User.Identity.Name");

            // functions that are gonna be called by the client 



            // functions that the server gonna call
            hub.client.loadallObjects = function (allObjects) {

                for (i = 0 ; i < allObjects.length; i++) {
                    if (allObjects[i].mypossition != null) {
                        $('#' + allObjects[i].mypossition + '').append($('<div id="' + allObjects[i].id + '" class="' + allObjects[i].cssClass + '"> </div> '))

                    } else {
                        $('.newusers').append($('<div id="' + allObjects[i].id + '" class="' + allObjects[i].cssClass + '"> </div> '))
                    }
                }

                $('#@User.Identity.Name').draggable({
                    revert: "invalid",
                    drag: function () {
                        hub.server.moveObject(this.id, this.offsetLeft, this.offsetTop || 0)
                    }
                })

            };
           

            hub.client.loadothersObjects = function (allObjects) {

                for (i = 0 ; i < allObjects.length; i++) {
                    if (allObjects[i].mypossition != null) {
                        $('#' + allObjects[i].mypossition + '').append($('<div id="' + allObjects[i].id + '" class="' + allObjects[i].cssClass + '"> </div> '))

                    } else {
                        $('.newusers').append($('<div id="' + allObjects[i].id + '" class="' + allObjects[i].cssClass + '"> </div> '))
                    }
                }
              
            };

            hub.client.removeObject = function (userName) {

                $('#' + userName).remove();

            };


            hub.client.newObject = function (username, css, possition) {
                if (possition != null) {
                    $('#' + possition + '').append($('<div id="' + username + '" class="' + css + '"> </div> '))

                } else {
                    $('.newusers').append($('<div id="' + username + '" class="' + css + '"> </div> '))
                }
            }

            hub.client.myObject = function (username, css) {

                $('.newusers').append($('<div id="' + username + '" class="' + css + '"> </div> '))
               
                $('#' + username + '').draggable({
                    revert: "invalid",
                    drag: function () {
                        hub.server.moveObject(this.id, this.offsetLeft, this.offsetTop || 0)
                    }
                })

            }

            hub.client.objectMoved = function (id, x, y) {

                $("#" + id + "").offset({ left: x, top: y })
              //  $shape.css({left : x , top : y})
            };

            hub.client.objectInsertedDiv = function (idObj, idDiv ) {

                $object = $("#" + idObj + "");
                $div = $("#" + idDiv + "");
                $object.appendTo($div).css({ left: 0, top: 0 });

            };


            // funtion that will runs when start 

            $.connection.hub.start().done(function () {

                hub.server.connect("@User.Identity.Name")
                
                $(".droppable").droppable({
                    activeClass: "ui-state-hover",
                    hoverClass: "ui-state-active",
                    drop: function (event, ui) {
                        insertObjectDiv(ui.draggable, this.id)
                        

                    }
                });

                function insertObjectDiv($item, id) {
                    $div = $("#" + id + "");
                    $item.appendTo($div).css({ left: 0, top: 0 });
                    hub.server.insertobjectintoDiv($item.attr('id'), id)
                    hub.server.especificPossition($item.attr('id'), $item.attr("class"), id)
                }


            })


           

        })

    </script>
    }


